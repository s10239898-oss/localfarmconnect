{% extends "base.html" %}

{% block title %}Cart Â· LocalFarmConnect{% endblock %}

{% block content %}
<section class="relative space-y-8 fade-in">

  <!-- Background -->
  <div class="absolute inset-0 -z-10 bg-gradient-to-br from-emerald-50 via-white to-green-100"></div>
  <div class="absolute top-10 left-10 w-72 h-72 bg-emerald-200/30 blur-3xl rounded-full -z-10"></div>

  <!-- Header -->
  <header>
    <h1 class="text-3xl font-bold text-slate-900 tracking-tight">
      Your cart
    </h1>
    <p class="text-sm text-slate-500 mt-1">
      Review your items before checkout.
    </p>
  </header>

  {% if items %}
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- Cart Table -->
    <div class="lg:col-span-2 rounded-3xl bg-white/85 backdrop-blur-xl border border-white/40
                shadow-xl p-5 sm:p-6 overflow-x-auto">

      <form method="post" action="{% url 'cart-update' %}" class="space-y-4">
        {% csrf_token %}

        <table class="min-w-full text-sm">

          <thead class="border-b border-slate-200 text-xs text-slate-500 uppercase tracking-wide">
            <tr>
              <th class="text-left py-3 pr-4">Product</th>
              <th class="text-left py-3 pr-4">Farmer</th>
              <th class="text-left py-3 pr-4">Price</th>
              <th class="text-left py-3 pr-4">Quantity</th>
              <th class="text-left py-3 pr-4">Subtotal</th>
              <th class="py-3"></th>
            </tr>
          </thead>

          <tbody class="divide-y divide-slate-100">

            {% for it in items %}
            <tr class="hover:bg-slate-50/60 transition">

              <td class="py-4 pr-4">
                <a href="{% url 'product-detail' it.product.id %}"
                   class="font-semibold text-slate-800 hover:text-emerald-700 transition">
                  {{ it.product.name }}
                </a>
              </td>

              <td class="py-4 pr-4 text-slate-500">
                {{ it.product.farmer.farm_name }}
              </td>

              <td class="py-4 pr-4 text-slate-700 font-medium">
                KSh {{ it.product.price }}
              </td>

              <!-- Quantity -->
              <td class="py-4 pr-4">
                <div class="flex items-center gap-2">
                  <input type="number"
                         name="qty_{{ it.product.id }}"
                         value="{{ it.quantity }}"
                         min="0"
                         max="{{ it.max_qty }}"
                         class="w-20 rounded-xl border-slate-200 text-sm
                                focus:border-emerald-500 focus:ring-emerald-200">

                  <span class="text-[0.7rem] text-slate-400">
                    max {{ it.max_qty }}
                  </span>
                </div>
              </td>

              <td class="py-4 pr-4 font-semibold text-slate-900">
                KSh {{ it.line_total }}
              </td>

              <td class="py-4 text-right">
                <button type="submit"
                        name="remove"
                        value="{{ it.product.id }}"
                        class="text-xs font-semibold text-red-600 hover:text-red-700 transition">
                  Remove
                </button>
              </td>

            </tr>
            {% endfor %}

          </tbody>
        </table>

        <!-- Update Button -->
        <div class="flex justify-between items-center pt-4 border-t border-slate-100">
          <button type="submit"
            class="rounded-xl bg-slate-100 px-4 py-2 text-xs font-semibold text-slate-800
                   hover:bg-slate-200 transition">
            Update cart
          </button>
        </div>

      </form>
    </div>

    <!-- Order Summary -->
    <aside class="rounded-3xl bg-white/85 backdrop-blur-xl border border-white/40
                  shadow-xl p-6 space-y-5 h-fit">

      <h2 class="text-lg font-semibold text-slate-900">
        Order summary
      </h2>

      <div class="space-y-2 text-sm">
        <div class="flex justify-between text-slate-600">
          <span>Subtotal</span>
          <span>KSh {{ total }}</span>
        </div>
      </div>

      <div class="pt-3 border-t border-slate-100 flex justify-between text-base font-bold text-slate-900">
        <span>Total</span>
        <span>KSh {{ total }}</span>
      </div>

      <a href="{% url 'checkout' %}"
         class="group relative overflow-hidden w-full inline-flex justify-center items-center
                rounded-xl bg-gradient-to-r from-emerald-600 to-green-600
                px-4 py-3 text-sm font-semibold text-white
                shadow-lg hover:shadow-xl transition">

        <span class="relative z-10">Proceed to checkout</span>
        <div class="absolute inset-0 opacity-0 group-hover:opacity-100 bg-white/10 transition"></div>
      </a>

      <p class="text-[0.7rem] text-slate-400">
        Prices and stock are confirmed at checkout.
      </p>

    </aside>

  </div>

  {% else %}

  <!-- Empty Cart -->
  <div class="rounded-3xl bg-white/85 backdrop-blur-xl border border-white/40
              shadow-xl p-12 text-center">

    <div class="text-5xl mb-3">ðŸ›’</div>

    <p class="text-sm font-medium text-slate-700">
      Your cart is empty.
    </p>

    <p class="text-xs text-slate-400 mt-1 mb-6">
      Browse the marketplace to add fresh products.
    </p>

    <a href="{% url 'marketplace' %}"
       class="inline-flex items-center rounded-xl
              bg-gradient-to-r from-emerald-600 to-green-600
              px-5 py-2.5 text-sm font-semibold text-white
              shadow-lg hover:shadow-xl transition">
      Browse products
    </a>

  </div>

  {% endif %}
</section>
{% endblock %}