{% extends "base.html" %}

{% block title %}Marketplace Â· LocalFarmConnect{% endblock %}

{% block content %}
<section class="relative space-y-8 fade-in">

  <!-- Background -->
  <div class="absolute inset-0 -z-10 bg-gradient-to-br from-emerald-50 via-white to-green-100"></div>
  <div class="absolute top-10 left-10 w-72 h-72 bg-emerald-200/30 blur-3xl rounded-full -z-10"></div>

  <!-- Header + Filters -->
  <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">

    <div>
      <h1 class="text-3xl font-bold text-slate-900 tracking-tight">
        Marketplace
      </h1>
      <p class="text-sm text-slate-500 mt-1">
        Discover fresh products directly from local farmers.
      </p>
    </div>

    <form method="get"
          class="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center
                 rounded-2xl bg-white/80 backdrop-blur-xl border border-white/40
                 shadow-lg px-4 py-3">

      <!-- Category -->
      <div class="flex items-center gap-2">
        <label class="text-xs font-semibold text-slate-500 uppercase tracking-wide">
          Category
        </label>
        <select name="category"
                class="rounded-xl border-slate-200 text-sm
                       focus:border-emerald-500 focus:ring-emerald-200 bg-white">
          <option value="">All</option>
          {% for c in categories %}
          <option value="{{ c.id }}"
            {% if selected_category|add:'' == c.id|add:'' %}selected{% endif %}>
            {{ c.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <!-- Search -->
      <div class="relative">
        <input type="text"
               name="q"
               value="{{ request.GET.q|default_if_none:'' }}"
               placeholder="Search products..."
               class="w-full sm:w-64 rounded-xl border-slate-200 pl-4 pr-4 py-2 text-sm
                      focus:border-emerald-500 focus:ring-emerald-200">
      </div>

      <!-- Button -->
      <button type="submit"
        class="rounded-xl bg-slate-900 px-5 py-2 text-sm font-semibold text-white
               shadow-md hover:bg-slate-800 hover:shadow-lg transition">
        Filter
      </button>
    </form>
  </header>

  <!-- Products Grid -->
  {% if products %}
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

    {% for p in products %}
    <article class="group rounded-3xl bg-white/85 backdrop-blur-xl
                    border border-white/40 shadow-xl overflow-hidden
                    hover:shadow-2xl hover:-translate-y-1 transition-all duration-300
                    flex flex-col">

      <!-- Image -->
      {% if p.image %}
      <div class="overflow-hidden">
        <img src="{{ p.image.url }}" alt="{{ p.name }}"
             class="h-44 w-full object-cover group-hover:scale-105 transition duration-500">
      </div>
      {% else %}
      <div class="h-44 w-full bg-emerald-50 flex items-center justify-center text-emerald-700 text-xs">
        No image
      </div>
      {% endif %}

      <!-- Content -->
      <div class="p-5 flex-1 flex flex-col gap-2">

        <h2 class="font-semibold text-slate-900 line-clamp-1">
          {{ p.name }}
        </h2>

        <p class="text-xs text-slate-500">
          By <span class="font-medium text-slate-700">{{ p.farmer.farm_name }}</span>
        </p>

        <p class="text-lg font-bold text-emerald-700">
          KSh {{ p.price }}
        </p>

        <div class="flex items-center justify-between text-xs text-slate-500">
          <span>Stock: {{ p.quantity_available }}</span>
          <span class="text-amber-600">Rating â€”</span>
        </div>

        <!-- CTA -->
        <div class="mt-3">
          <a href="{% url 'product-detail' p.id %}"
             class="group relative overflow-hidden w-full inline-flex justify-center items-center
                    rounded-xl bg-gradient-to-r from-emerald-600 to-green-600
                    px-3 py-2 text-xs font-semibold text-white shadow-md
                    hover:shadow-lg transition">

            <span class="relative z-10">View details</span>
            <div class="absolute inset-0 opacity-0 group-hover:opacity-100 bg-white/10 transition"></div>
          </a>
        </div>

      </div>
    </article>
    {% endfor %}

  </div>

  {% else %}
  <!-- Empty State -->
  <div class="rounded-3xl bg-white/80 backdrop-blur-xl border border-white/40 shadow-xl
              p-12 text-center text-slate-500">

    <div class="text-4xl mb-3">ðŸŒ¾</div>
    <p class="text-sm font-medium">
      No products available yet.
    </p>
    <p class="text-xs text-slate-400 mt-1">
      Check back soon for fresh farm produce.
    </p>

  </div>
  {% endif %}

  <!-- Pagination -->
  {% if is_paginated %}
  <div class="flex items-center justify-center gap-6 text-sm mt-6">

    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}"
       class="px-4 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 transition">
      Previous
    </a>
    {% endif %}

    <span class="text-slate-600 font-medium">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}"
       class="px-4 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 transition">
      Next
    </a>
    {% endif %}

  </div>
  {% endif %}

</section>
{% endblock %}